- name: Generate DNS block from all_cf_entries
  set_fact:
    dns_block: |
      {{ dns_block_start }}
      {% for zone in all_cf_entries %}
      - zone: {{ zone.zone }}
        dns_entries:
      {% for entry in zone.dns_entries %}
        - { name: "{{ entry.name }}", type: "{{ entry.type }}", value: "{{ entry.content }}" }
      {% endfor %}
      {% endfor %}
      {{ dns_block_end }}

- name: Replace DNS block in inventory file
  replace:
    path: "{{ inventory_file }}"
    regexp: "(?s){{ dns_block_start }}.*{{ dns_block_end }}"
    replace: "{{ dns_block }}"

- name: Debug DNS block
  debug:
    msg: "{{ dns_block }}"
